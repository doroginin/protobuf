package generator

import (
	"strings"
	"text/template"
)

var HandlerTemplate = &Template{
	FileName: "%s.pb.http.handler.go",
	Body: template.Must(template.New(`file`).Funcs(template.FuncMap{
		`lower`: strings.ToLower,
	}).Parse(`
// Code generated by protoc-gen-go-http-server.
// source: {{ .Source }}

package {{ .Package }}

import (
	"net/http"
)

{{ range $sIdx, $service := .Services }}

{{ range $hIdx, $handler := $service.Handlers }}
func (s *{{ $service.Name }}HTTPServer) {{ $handler.Name }}(w http.ResponseWriter, r *http.Request) {
    defer r.Body.Close()
	r, _, in, err := s.opts.cdc.ReadRequest(r)
    if err != nil {
        s.opts.cdc.WriteResponse(w, nil, err)
		return
    }
	resp, err := s.opts.srv.{{ $handler.Name }}(r.Context(), in.(*{{ $handler.In }}))
	if err != nil {
        s.opts.cdc.WriteResponse(w, nil, err)
		return
	}
	s.opts.cdc.WriteResponse(w, resp, nil)
}
{{ end }}
{{ end }}`))}